!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).draggable=t()}(this,function(){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function l(e,t){var n,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length)return i&&(e=i),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,l=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return l=e.done,e},e:function(e){o=!0,r=e},f:function(){try{l||null==i.return||i.return()}finally{if(o)throw r}}}}return function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.parent=e.groupElement,this.scrollElement=e.scrollElement||e.groupElement,this.dragElement=e.dragElement,this.dragEnd=e.dragEnd,this.cloneElementStyle=e.cloneElementStyle,this.cloneElementClass=e.cloneElementClass,this.delay=e.delay||300,this.rectList=[],this.isMousedown=!1,this.isMousemove=!1,this.drag={element:null,index:0,lastIndex:0},this.drop={element:null,index:0,lastIndex:0},this.clone={element:null,x:0,y:0,exist:!1},this.diff={old:{node:null,rect:{}},new:{node:null,rect:{}}},this._debounce(this.init(),50)}var e,n,i;return e=t,(n=[{key:"init",value:function(){this.parent?(this._bindEventListener(),this._getChildrenRect()):console.error("Error: groupElement is required")}},{key:"destroy",value:function(){this._unbindEventListener(),this._resetState()}},{key:"_getChildrenRect",value:function(){this.rectList.length=0;var e,t=l(this.parent.children);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.rectList.push(n.getBoundingClientRect())}}catch(e){t.e(e)}finally{t.f()}}},{key:"_handleMousedown",value:function(e){var o=this;if(0!==e.button)return!0;if(e.target===this.parent)return!0;this.rectList.length||this._getChildrenRect();try{var t=this.dragElement?this.dragElement(e):e.target;if(!t)return!0;this.drag.element=t}catch(e){return!0}this.isMousedown=!0;var s={x:e.clientX,y:e.clientY},t=(this.clone.element=this.drag.element.cloneNode(!0),this._getElementIndex());this.diff.old.rect=this.rectList[t],this.clone.x=this.rectList[t].left,this.clone.y=this.rectList[t].top,this.drag.index=t,this.drag.lastIndex=t,document.onmousemove=function(e){if(o._initCloneElement(),o._handleCloneMove(),e.preventDefault(),o.isMousedown){o.isMousemove=!0,o.clone.x+=e.clientX-s.x,o.clone.y+=e.clientY-s.y,s.x=e.clientX,s.y=e.clientY,o._handleCloneMove();for(var t=0;t<o.rectList.length;t++){var n=o.rectList[t],i=n.left,r=n.right,l=n.top,n=n.bottom;if(e.clientX>i&&e.clientX<r&&e.clientY>l&&e.clientY<n){o.drop.element=o.parent.children[t],o.drop.lastIndex=t,o.drag.element!==o.drop.element&&(o.drag.index<t?(o.parent.insertBefore(o.drag.element,o.drop.element.nextElementSibling),o.drop.index=t-1):(o.parent.insertBefore(o.drag.element,o.drop.element),o.drop.index=t+1),o.drag.index=t,o._animate(o.drag.element,o.rectList[o.drag.index],o.rectList[o.drag.lastIndex]),o._animate(o.drop.element,o.rectList[o.drop.index],o.rectList[o.drop.lastIndex]),o.drag.lastIndex=t,o.diff.old.node=o.drag.element,o.diff.new.node=o.drop.element),o.diff.new.rect=o.rectList[t];break}}}},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,o.isMousedown&&o.isMousemove&&o.dragEnd&&o.dragEnd(o.diff.old,o.diff.new),o.isMousedown=!1,o.isMousemove=!1,o._destroyClone(),o._clearDiff()}}},{key:"_initCloneElement",value:function(){for(var e in this.clone.element.class=this.cloneElementClass,this.clone.element.style.transition="none",this.clone.element.style.position="fixed",this.clone.element.style.left=0,this.clone.element.style.top=0,this.cloneElementStyle)this._styled(this.clone.element,e,this.cloneElementStyle[e]);this.clone.element.exist||(document.body.appendChild(this.clone.element),this.clone.element.exist=!0)}},{key:"_handleCloneMove",value:function(){this.clone.element.style.transform="translate3d(".concat(this.clone.x,"px, ").concat(this.clone.y,"px, 0)")}},{key:"_destroyClone",value:function(){this.clone.element.remove(),this.clone={element:null,x:0,y:0,exist:!1}}},{key:"_getElementIndex",value:function(){var e=Array.from(this.parent.children),t=this.drag.element,n=e.indexOf(t);if(-1<n)return n;for(var i=0;i<e.length;i++)if(this._isChildOf(t,e[i]))return i}},{key:"_isChildOf",value:function(e,t){var n;if(e&&t)for(n=e.parentNode;n;){if(t===n)return!0;n=n.parentNode}return!1}},{key:"_animate",value:function(e,t,n){var i=this;this._styled(e,"transition","none"),this._styled(e,"transform","translate3d(".concat(n.left-t.left,"px, ").concat(n.top-t.top,"px, 0)")),e.offsetLeft,this._styled(e,"transition","all ".concat(this.delay,"ms")),this._styled(e,"transform","translate3d(0px, 0px, 0px)"),clearTimeout(e.animated),e.animated=setTimeout(function(){i._styled(e,"transition",""),i._styled(e,"transform",""),e.animated=null},this.delay)}},{key:"_styled",value:function(e,t,n){var i=e&&e.style;if(i){if(void 0===n)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),void 0===t?n:n[t];i[t=t in i?t:"-webkit-"+t]=n+("string"==typeof n?"":"px")}}},{key:"_resetState",value:function(){this.isMousedown=!1,this.isMousemove=!1,this.rectList.length=0,this.drag={element:null,index:0,lastIndex:0},this.drop={element:null,index:0,lastIndex:0},this._destroyClone(),this._clearDiff()}},{key:"_clearDiff",value:function(){this.diff={old:{node:null,rect:{}},new:{node:null,rect:{}}}}},{key:"_bindEventListener",value:function(){this._handleMousedown=this._handleMousedown.bind(this),this._getChildrenRect=this._getChildrenRect.bind(this),this.parent.addEventListener("mousedown",this._handleMousedown),this.scrollElement.addEventListener("scroll",this._debounce(this._getChildrenRect,50)),window.addEventListener("scroll",this._debounce(this._getChildrenRect,50)),window.addEventListener("resize",this._debounce(this._getChildrenRect,50)),window.addEventListener("orientationchange",this._debounce(this._getChildrenRect,50))}},{key:"_unbindEventListener",value:function(){this.parent.removeEventListener("mousedown",this._handleMousedown),this.scrollElement.removeEventListener("scroll",this._getChildrenRect),window.removeEventListener("scroll",this._getChildrenRect),window.removeEventListener("resize",this._getChildrenRect),window.removeEventListener("orientationchange",this._getChildrenRect)}},{key:"_debounce",value:function(r,l){return function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];clearTimeout(r.id),r.id=setTimeout(function(){r.call.apply(r,[e].concat(n))},l)}}}])&&r(e.prototype,n),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}()});
